<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consultation Status</title>

  <style>
    body { background: #eaf7ff; margin: 0; font-family: Arial; }

    nav {
      background: #4CAF50;
      color: white;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .container {
      max-width: 850px;
      background: white;
      margin: 30px auto;
      padding: 20px;
      border-radius: 12px;
    }

    h1 { text-align: center; color: #2c3e50; }

    .status-list { margin-top: 20px; }

    .status-card {
      background: #f9f9f9;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 15px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.12);
    }

    .status-row { display: flex; justify-content: space-between; }

    .status-pill {
      padding: 6px 12px;
      border-radius: 50px;
      font-size: 13px;
      font-weight: bold;
      text-transform: capitalize;
      color: white;
    }

    .pending { background: #ffa726; }
    .accepted { background: #26a69a; }
    .rejected { background: #ef5350; }

    #languageSwitcher { padding: 5px; border-radius: 6px; }
  </style>
</head>

<body>

<nav>
  <span class="logo"
        data-en="Consultation Status"
        data-kn="ಸಲಹೆ ಸ್ಥಿತಿ">
        Consultation Status
  </span>

  <select id="languageSwitcher">
    <option value="en">English</option>
    <option value="kn">ಕನ್ನಡ</option>
  </select>
</nav>

<div class="container">
  <h1 data-en="Your Consultation Requests"
      data-kn="ನಿಮ್ಮ ಸಲಹೆ ವಿನಂತಿಗಳು">
      Your Consultation Requests
  </h1>

  <div id="statusList" class="status-list"></div>
</div>

<script>
  const BACKEND = "http://127.0.0.1:5000";

  // ==============================
  // MULTI LANGUAGE SUPPORT
  // ==============================
  const switcher = document.getElementById("languageSwitcher");
  const saved = localStorage.getItem("lang") || "en";
  switcher.value = saved;
  setLang(saved);

  switcher.addEventListener("change", () => setLang(switcher.value));

  function setLang(lang) {
    document.querySelectorAll("[data-en]").forEach(el => {
      el.textContent = el.getAttribute("data-" + lang);
    });
    localStorage.setItem("lang", lang);
  }

  // ==============================
  // FETCH CONSULTATION HISTORY
  // ==============================
  async function loadStatus() {
    const token = localStorage.getItem("access_token");
    const box = document.getElementById("statusList");

    if (!token) {
      box.innerHTML = "<p>Please login first.</p>";
      return;
    }

    const res = await fetch(`${BACKEND}/api/consultations/parent`, {
      headers: { "Authorization": `Bearer ${token}` }
    });

    const data = await res.json();
    box.innerHTML = "";

    if (!data.length) {
      box.innerHTML = `
        <p data-en="No consultation requests found"
           data-kn="ಯಾವುದೇ ಸಲಹೆ ವಿನಂತಿಗಳು ಕಂಡುಬಂದಿಲ್ಲ">
           No consultation requests found
        </p>`;
      return;
    }

    data.forEach(item => {
      const card = document.createElement("div");
      card.classList.add("status-card");

      let statusClass = "pending";
      if (item.status === "accepted") statusClass = "accepted";
      if (item.status === "rejected") statusClass = "rejected";

      card.innerHTML = `
        <div class="status-row">
          <div>
            <p><strong data-en="Doctor:" data-kn="ಡಾಕ್ಟರ್:">Doctor:</strong> ${item.doctor_name}</p>
            <p><strong data-en="Requested At:" data-kn="ವಿನಂತಿ ಮಾಡಿದ ದಿನ:">Requested At:</strong> ${item.requested_at}</p>
          </div>
          <div class="status-pill ${statusClass}">
            ${item.status}
          </div>
        </div>
      `;

      box.appendChild(card);
    });
  }

  loadStatus();
</script>

</body>
<script src="script.js"></script>

</html>
